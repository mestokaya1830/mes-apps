//users
db.exec(`
CREATE TABLE IF NOT EXISTS users (
    id INTEGER PRIMARY KEY,                         -- Primary key
    gender TEXT NOT NULL,                           -- Gender
    first_name TEXT NOT NULL,                       -- First name
    last_name TEXT NOT NULL,                        -- Last name
    password TEXT NOT NULL,                         -- User password
    email TEXT UNIQUE NOT NULL,                     -- Email address
    phone TEXT NOT NULL,                            -- Phone number
    address TEXT NOT NULL,                          -- Street address
    postal_code TEXT NOT NULL,                      -- Postal code
    city TEXT NOT NULL,                             -- City
    state TEXT NOT NULL,                            -- State / Region
    country TEXT DEFAULT 'Deutschland',             -- Country
    website TEXT,                                   -- Optional website

    company_name TEXT NOT NULL,                     -- Company name
    company_details TEXT NOT NULL,                  -- Company details / description
    company_signature TEXT NOT NULL,                -- Company type signature (GmbH, AG, etc.)
    contact_person TEXT,                            -- Contact person (e.g., CEO)

    tax_number TEXT NOT NULL,                       -- Tax number
    tax_office TEXT,                                -- Optional tax office
    vat_id TEXT,                                    -- VAT ID
    court_registration TEXT,                        -- Optional court registration number
    court_location TEXT,                            -- Court location (Amtsgericht)

    logo TEXT NOT NULL,                             -- Logo file path
    image_type TEXT NOT NULL,                       -- Logo image type

    bank_name TEXT NOT NULL,                        -- Bank name
    bic TEXT NOT NULL,                              -- Bank BIC / SWIFT
    iban TEXT NOT NULL,                             -- Bank IBAN
    bank_account_holder TEXT NOT NULL,             -- Account holder name

    invoice_approved TEXT NOT NULL,                -- Invoice approval status

    created_at DATETIME DEFAULT CURRENT_TIMESTAMP, -- Record creation timestamp
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP  -- Record update timestamp
);
`);




//tokens
db.exec(`CREATE TABLE tokens (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    token TEXT UNIQUE NOT NULL,
    user_id INTEGER,
    expires_at DATETIME NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);`)

--------------------------------------------------------------------------------------------------
//customers
db.exec(`
CREATE TABLE IF NOT EXISTS customers (
    id INTEGER PRIMARY KEY AUTOINCREMENT,          -- Primary key
    is_active INTEGER NOT NULL DEFAULT 1,          -- Active status (1 = active, 0 = inactive)

    company_type TEXT NOT NULL,                     -- Company type (GmbH, AG, etc.)
    company_name TEXT NOT NULL,                     -- Company name

    first_name TEXT NOT NULL,                       -- Contact first name
    last_name TEXT NOT NULL,                        -- Contact last name
    full_name TEXT NOT NULL,                        -- Full name (concatenated)

    email TEXT NOT NULL,                            -- Email address
    phone TEXT NOT NULL,                            -- Phone number
    website TEXT NOT NULL,
    address TEXT NOT NULL,                          -- Street address
    postal_code TEXT NOT NULL,                      -- Postal code
    city TEXT NOT NULL,                             -- City
    country TEXT NOT NULL,                          -- Country

    tax_number TEXT NOT NULL,                       -- Tax number
    vat_id TEXT NOT NULL,                           -- VAT ID

    created_at DATETIME DEFAULT CURRENT_TIMESTAMP, -- Record creation timestamp
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP  -- Record update timestamp
);
`);


---------------------------------------------------------------------------------------------------
//invoices
db.exec(`
CREATE TABLE IF NOT EXISTS invoices (
    id INTEGER PRIMARY KEY AUTOINCREMENT,           -- Primary key
    customer_id INTEGER NOT NULL,                   -- Foreign key to customers
    customer TEXT NOT NULL,                         -- Customer info as text
    is_active INTEGER NOT NULL DEFAULT 1,          -- Active status (1 = active, 0 = inactive)
    
    cancelled_at TEXT DEFAULT '',                               -- Cancellation timestamp
    cancelled_by TEXT DEFAULT '',
    cancellation_reason TEXT DEFAULT '',             -- Reason for cancellation

    date TEXT NOT NULL,                             -- Invoice date
    service_date TEXT NOT NULL,                     -- Service date
    due_date TEXT NOT NULL,                         -- Due date

    currency TEXT NOT NULL,                         -- Currency code
    payment_terms INTEGER NOT NULL,                 -- Payment terms in days
    payment_conditions TEXT NOT NULL,              -- Payment conditions description
    early_payment_discount INTEGER NOT NULL,       -- Early payment discount flag
    early_payment_percentage INTEGER NOT NULL,     -- Early payment discount percentage
    early_payment_days INTEGER NOT NULL,           -- Early payment discount days

    is_small_company INTEGER NOT NULL,             -- Small company flag
    is_reverse_charge INTEGER NOT NULL,            -- Reverse charge flag
    is_eu_delivery INTEGER NOT NULL,               -- EU delivery flag

    positions TEXT NOT NULL,                        -- JSON/text of invoice positions
    net_total INTEGER NOT NULL,                     -- Net total amount
    vat_total INTEGER NOT NULL,                     -- VAT total amount
    gross_total INTEGER NOT NULL,                   -- Gross total amount
    total_after_discount INTEGER NOT NULL,         -- Total after discount

    created_at DATETIME DEFAULT CURRENT_TIMESTAMP, -- Record creation timestamp
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, -- Record update timestamp

    FOREIGN KEY (customer_id) REFERENCES customers(id) ON DELETE CASCADE
);
`);


-----------------------------------------------------------------------------------------------
db.exec(`
CREATE TABLE IF NOT EXISTS offers (
    id INTEGER PRIMARY KEY AUTOINCREMENT,           -- Primary key
    customer_id INTEGER NOT NULL,                   -- Foreign key to customers

    date TEXT NOT NULL,                             -- Offer creation date
    valid_until TEXT NOT NULL,                      -- Offer validity date
    
    customer JSON NOT NULL,                         -- Customer info stored as JSON
    contact_person TEXT,                            -- Contact person for the offer

    subject TEXT NOT NULL,                          -- Offer subject / description
    currency TEXT NOT NULL,                         -- Currency code
    payment_terms TEXT NOT NULL,                    -- Payment terms description
    delivery_terms TEXT NOT NULL,                   -- Delivery terms
    delivery_time TEXT NOT NULL,                    -- Delivery time description

    positions TEXT NOT NULL,                        -- Offer positions stored as JSON/text
    net_total INTEGER NOT NULL,                     -- Net total amount
    vat_total INTEGER NOT NULL,                     -- VAT total amount
    gross_total INTEGER NOT NULL,                   -- Gross total amount

    status TEXT NOT NULL,                            -- Offer status (draft, accepted, rejected)
    status_by TEXT,
    status_date TEXT,
    status_comments TEXT,
    is_active INTEGER NOT NULL DEFAULT 1,          -- Active flag
    is_legal INTEGER NOT NULL DEFAULT 1,           -- Legally binding flag

    introduction_text TEXT NOT NULL,                -- Introduction text for the offer
    closing_text TEXT NOT NULL,                     -- Closing text for the offer
    notes TEXT NOT NULL,                            -- Public notes
    
    internal_notes TEXT,                            -- Internal notes (private)

    created_at DATETIME DEFAULT CURRENT_TIMESTAMP, -- Record creation timestamp
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP, -- Record update timestamp

    FOREIGN KEY (customer_id) REFERENCES customers(id) ON DELETE RESTRICT,
    FOREIGN KEY (invoice_id) REFERENCES invoices(id) ON DELETE SET NULL
);
`);
----------------------------------------------------------------------------------------------------------
db.exec(`
CREATE TABLE IF NOT EXISTS orders (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    customer_id INTEGER,
    customer TEXT DEFAULT '{}',

    date TEXT DEFAULT '',
    validity_date TEXT DEFAULT '',
    service_period_start TEXT DEFAULT '',
    service_period_end TEXT DEFAULT '',

    status TEXT DEFAULT 'pending',
    status_date TEXT DEFAULT '',
    status_by TEXT DEFAULT '',
    status_comments TEXT DEFAULT '',

    is_active INTEGER DEFAULT 1,
    cancelled_at TEXT DEFAULT '',
    cancelled_by TEXT DEFAULT '',
    cancellation_reason TEXT DEFAULT '',

    delivery_terms TEXT DEFAULT '',
    delivery_address TEXT DEFAULT '',
    delivery_postal_code TEXT DEFAULT '',
    delivery_city TEXT DEFAULT '',
    delivery_country TEXT DEFAULT 'Deutschland',
    delivery_date TEXT DEFAULT '',
    shipping_method TEXT DEFAULT '',

    payment_terms INTEGER DEFAULT 14,
    payment_method TEXT DEFAULT '',
    payment_conditions TEXT DEFAULT '',
    payment_reference TEXT DEFAULT '',
    currency TEXT DEFAULT 'EUR.de-DE',
    net_total INTEGER DEFAULT 0,
    vat_total INTEGER DEFAULT 0,
    gross_total INTEGER DEFAULT 0,


    positions TEXT DEFAULT '[]',
    customer_reference TEXT DEFAULT '',
    attachments TEXT DEFAULT '[]',
    priority TEXT DEFAULT '',
    internal_status_notes TEXT DEFAULT '',

    intro_text TEXT DEFAULT '',
    customer_notes TEXT DEFAULT '',
    internal_notes TEXT DEFAULT '',
    closing_text TEXT DEFAULT '',

    sent_at TEXT DEFAULT '',
    sent_method TEXT DEFAULT '',

    created_at TEXT DEFAULT (datetime('now')),
    updated_at TEXT DEFAULT (datetime('now')),

    FOREIGN KEY (customer_id) REFERENCES customers(id) ON DELETE RESTRICT
);
`);

----------------------------------------------------------------------------------------------
db.exec(`
CREATE TABLE IF NOT EXISTS payments (
    id INTEGER PRIMARY KEY AUTOINCREMENT,           -- Primary key
    invoice_id INTEGER NOT NULL,                     -- Foreign key to invoices
    customer_id INTEGER NOT NULL,                    -- Foreign key to customers

    invoice_date TEXT NOT NULL,                      -- Invoice date
    invoice_due_date TEXT NOT NULL,                  -- Invoice due date
    currency TEXT NOT NULL,                          -- Currency
    invoice_total REAL NOT NULL,                             -- Total invoice amount

    payment_date TEXT NOT NULL,                      -- Payment date
    paid_amount REAL NOT NULL,                       -- Amount paid in this payment
    outstanding_amount REAL NOT NULL DEFAULT 0,      -- Remaining amount after this payment

    payment_method TEXT NOT NULL,                    -- Payment method
    payment_reference TEXT NOT NULL,                 -- Payment reference / transaction ID
    counterparty_name TEXT NOT NULL,                 -- Counterparty name
    counterparty_iban TEXT NOT NULL,                 -- Counterparty IBAN

    notes TEXT,                                     -- Optional payment notes
    is_partially_paid INTEGER NOT NULL DEFAULT 1,    -- Partially paid flag
    is_paid INTEGER NOT NULL DEFAULT 0,             -- Fully paid flag
    file_name TEXT,                                 -- Optional file / receipt name

    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,  -- Record creation timestamp
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,  -- Record update timestamp

    FOREIGN KEY (invoice_id) REFERENCES invoices(id) ON DELETE CASCADE,
    FOREIGN KEY (customer_id) REFERENCES customers(id) ON DELETE CASCADE
);
`);

--------------------------------------------------------------------------------------------
db.exec(`
CREATE TABLE IF NOT EXISTS reminders (
    id INTEGER PRIMARY KEY AUTOINCREMENT,           -- Primary key

    invoice_id INTEGER NOT NULL,                     -- Foreign key to invoices
    customer_id INTEGER NOT NULL,                    -- Foreign key to customers

    invoice TEXT NOT NULL,
    
    is_sent INTEGER NOT NULL DEFAULT 0,             -- 1 = sent to customer
    is_cancelled INTEGER NOT NULL DEFAULT 0,        -- 1 = cancelled / voided

    level INTEGER NOT NULL,                          -- Reminder level (0 = first, 1 = 1st reminder, 2 = 2nd, 3 = final)
    level_text TEXT NOT NULL,                        -- Reminder text for level ("Zahlungserinnerung", "1. Mahnung", etc.)

    reminder_date TEXT NOT NULL,                     -- Official reminder date (PDF date)
    due_date_new TEXT NOT NULL,                      -- New due date (+days)
    reminder_fee INTEGER NOT NULL DEFAULT 0,        -- Reminder fee in cents (e.g., 500 = â‚¬5.00)
    late_interest INTEGER NOT NULL DEFAULT 0,       -- Late interest total

    intro_text TEXT NOT NULL DEFAULT '',            -- Introduction text
    main_text TEXT NOT NULL DEFAULT '',             -- Main body text
    closing_text TEXT NOT NULL DEFAULT '',          -- Closing text

    sent_at TEXT,                                   -- Actual sending date (email/post)
    sent_method TEXT,                               -- Method sent ('email', 'post', 'einschreiben', 'portal')

    proof_type TEXT,                                -- Proof type ('email', 'post', 'einschreiben', 'portal')
    proof_file_name TEXT,                           -- Proof file name (receipt, screenshot, etc.)
    proof_sent_at TEXT,                             -- Proof date (receipt date, etc.)

    created_at TEXT DEFAULT (datetime('now')),      -- Record creation timestamp
    updated_at TEXT DEFAULT (datetime('now')),      -- Record update timestamp

    FOREIGN KEY(invoice_id) REFERENCES invoices(id) ON DELETE CASCADE,
    FOREIGN KEY(customer_id) REFERENCES customers(id) ON DELETE CASCADE
);
`);

-------------------------------------------------------------------------------------
db.exec(`
CREATE TABLE IF NOT EXISTS deliveries (
    id INTEGER PRIMARY KEY AUTOINCREMENT,           -- Primary key
    order_id INTEGER,                                -- Reference to order (optional)
    invoice_id INTEGER,                              -- Reference to invoice (optional)
    customer_id INTEGER NOT NULL,                    -- Reference to customer
    
    date TEXT NOT NULL,

    customer TEXT NOT NULL,
    
    planned_delivery_date TEXT,                      -- Planned delivery date (optional)

    status TEXT NOT NULL DEFAULT 'pending',         -- Delivery status: pending, in_transit, delivered, partial, cancelled
    is_active INTEGER NOT NULL DEFAULT 1,           -- Active flag
    is_cancelled INTEGER NOT NULL DEFAULT 0,        -- Cancelled flag

    positions TEXT NOT NULL,
    
    delivery_date TEXT NOT NULL,                     -- Actual delivery date (official PDF date)
    delivered_by TEXT,                               -- Courier / delivery agent (DHL, UPS, own vehicle, pickup, etc.)
    delivery_method TEXT,                            -- Delivery method: package, freight, digital, pickup
    tracking_number TEXT,                            -- Tracking number (DHL, UPS, etc.)
    delivery_reference TEXT,                         -- Delivery reference (customer reference / Lieferschein number)
    received_by TEXT,                                -- Person who signed (should appear on proof)
    received_at TEXT,                                -- Time of receipt/signature

    delivery_address TEXT,                           -- Delivery street address
    delivery_postal_code TEXT,                       -- Delivery postal code
    delivery_city TEXT,                              -- Delivery city
    delivery_country TEXT DEFAULT 'Deutschland',    -- Delivery country

    delivered_total_cent INTEGER NOT NULL DEFAULT 0, -- Total delivered amount in cents
    remaining_total_cent INTEGER NOT NULL DEFAULT 0, -- Remaining amount in cents

    note TEXT DEFAULT '',                             -- Public notes
    internal_note TEXT DEFAULT '',                    -- Internal notes

    pdf_file_name TEXT,                              -- Delivery PDF file name
    proof_file_name TEXT,                            -- Proof file (signature photo, DHL receipt, etc.)
    proof_type TEXT,                                 -- Proof type: 'signature', 'photo', 'tracking', 'digital'

    created_at TEXT DEFAULT (datetime('now')),       -- Record creation timestamp
    updated_at TEXT DEFAULT (datetime('now')),       -- Record update timestamp

    FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE SET NULL,
    FOREIGN KEY (invoice_id) REFERENCES invoices(id) ON DELETE SET NULL,
    FOREIGN KEY (customer_id) REFERENCES customers(id) ON DELETE CASCADE
);
`);
