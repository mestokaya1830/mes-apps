

//users
db.exec(`CREATE TABLE IF NOT EXISTS users (
    id INTEGER PRIMARY KEY,
    gender TEXT NOT NULL,
    first_name TEXT NOT NULL,
    last_name TEXT NOT NULL,
    password TEXT NOT NULL,
    email TEXT UNIQUE NOT NULL,
    phone TEXT NOT NULL,
    address TEXT NOT NULL,
    postal_code TEXT NOT NULL,
    city TEXT NOT NULL,
    state TEXT NOT NULL,
    country TEXT DEFAULT 'Deutschland',
    website TEXT,
    company_name TEXT NOT NULL,
    company_details TEXT NOT NULL,
    company_signature TEXT NOT NULL,                -- GmbH, AG, OHG vs.
    contact_person TEXT,                       -- Geschäftsführer
    tax_number TEXT NOT NULL,                    -- Steuernummer
    tax_office TEXT,                             -- Opsiyonel (Steueramt)                             -- Opsiyonel (VAT ID prefix, örn: DE)
    vat_id TEXT,                                 -- USt-IdNr
    court_registration TEXT,                     -- Opsiyonel (Handelsregisternummer)
    court_location TEXT,                         -- Amtsgericht Berlin
    logo TEXT NOT NULL,
    image_type TEXT NOT NULL,
    bank_name TEXT NOT NULL,
    bic TEXT NOT NULL,
    iban TEXT NOT NULL,
    bank_account_holder TEXT NOT NULL,
    invoice_approved TEXT NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);`)


//tokens
db.exec(`CREATE TABLE tokens (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    token TEXT UNIQUE NOT NULL,
    user_id INTEGER,
    expires_at DATETIME NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);`)



//customers
db.exec(`CREATE TABLE IF NOT EXISTS customers (
    customer_id INTEGER PRIMARY KEY AUTOINCREMENT,
    customer_is_active INTEGER NOT NULL DEFAULT 1,
    customer_type TEXT NOT NULL,
    company_name TEXT NOT NULL,
    first_name TEXT NOT NULL,
    last_name TEXT NOT NULL,
    email TEXT NOT NULL,
    phone TEXT NOT NULL,
    address TEXT NOT NULL,
    postal_code TEXT NOT NULL,
    city TEXT NOT NULL,
    country TEXT NOT NULL,
    tax_number TEXT NOT NULL,
    vat_id TEXT NOT NULL,
    customer_created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    customer_updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
  )`)

//invoices
db.exec(`CREATE TABLE IF NOT EXISTS invoices (
    invoice_id INTEGER PRIMARY KEY AUTOINCREMENT,
    invoice_customer_id INTEGER NOT NULL,
    invoice_is_active INTEGER NOT NULL DEFAULT 1,
    invoice_date TEXT NOT NULL,
    due_date TEXT NOT NULL,
    service_date TEXT NOT NULL,
    currency TEXT NOT NULL,
    payment_terms INTEGER NOT NULL,
    payment_conditions TEXT NOT NULL,
    early_payment_discount INTEGER NOT NULL,
    early_payment_percentage INTEGER NOT NULL,
    early_payment_days INTEGER NOT NULL,
    is_small_company INTEGER NOT NULL,
    is_reverse_charge INTEGER NOT NULL,
    is_eu_delivery INTEGER NOT NULL,
    positions TEXT NOT NULL,
    subtotal INTEGER NOT NULL,
    vat_amount INTEGER NOT NULL,
    total INTEGER NOT NULL,
    invoice_created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    invoice_updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);`)

//payments

db.exec(`CREATE TABLE IF NOT EXISTS payments (
  payment_id INTEGER PRIMARY KEY AUTOINCREMENT,
  payment_date TEXT NOT NULL,
  amount INTEGER NOT NULL,
  method TEXT NOT NULL,
  reference TEXT NOT NULL,
  notes TEXT NOT NULL,
  partial_paid INTEGER NOT NULL,
  is_paid INTEGER NOT NULL,
  file_name TEXT NULL,
  payment_invoice_id INTEGER NOT NULL,
  payment_invoice_customer_id INTEGER NOT NULL,
  payment_created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  payment_updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (payment_invoice_id) REFERENCES invoices(payment_id) ON DELETE CASCADE
);`)

//offers

db.exec(`CREATE TABLE IF NOT EXISTS offers (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    is_active INTEGER NOT NULL DEFAULT 1,
    date TEXT NOT NULL,
    subject TEXT NOT NULL,
    is_legal INTEGER NOT NULL,
    valid_until TEXT NOT NULL,
    currency TEXT NOT NULL,
    customer TEXT NOT NULL,
    payment TEXT NOT NULL,
    positions TEXT NOT NULL,
    summary TEXT NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);`)



//orders

db.exec(`CREATE TABLE IF NOT EXISTS orders (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    is_active INTEGER NOT NULL DEFAULT 1,
    date TEXT NOT NULL,
    is_legal INTEGER NOT NULL,
    currency TEXT NOT NULL,
    service_period_start TEXT NOT NULL,
    service_period_end TEXT NOT NULL,
    validity_date TEXT NOT NULL,
    delivery_date TEXT NOT NULL,
    delivery_terms TEXT NOT NULL,
    shipping_method TEXT NOT NULL,
    customer_reference TEXT NOT NULL,
    customer_notes TEXT NOT NULL,
    internal_notes TEXT NOT NULL,
    special_notes TEXT NOT NULL,
    closing_text TEXT NOT NULL,
    customer TEXT NOT NULL,
    positions TEXT NOT NULL,
    payment TEXT NOT NULL,
    summary TEXT NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);`)

db.exec(`
  CREATE TABLE IF NOT EXISTS deliveries (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    order_id INTEGER,
    is_active INTEGER NOT NULL DEFAULT 1,
    date TEXT,
    delivery_status TEXT DEFAULT 'pending',
    delivered_by TEXT,
    delivery_reference TEXT,
    received_by TEXT,
    note TEXT,
    customer TEXT NOT NULL,
    positions TEXT NOT NULL,  -- JSON string
    created_at TEXT DEFAULT CURRENT_TIMESTAMP,
    updated_at TEXT DEFAULT CURRENT_TIMESTAMP
  );
`);


db.exec(`CREATE TABLE IF NOT EXISTS remeinders (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    is_active INTEGER NOT NULL DEFAULT 1,
    date TEXT NOT NULL,
    remeinder_fee TEXT NOT NULL,
    late_fee TEXT NOT NULL,
    level TEXT NOT NULL,
    intro_text TEXT NOT NULL,
    warning_text TEXT NOT NULL,
    closing_text TEXT NOT NULL,
    payment_deadline TEXT NOT NULL,
    selected_invoice TEXT NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);`)


CREATE INDEX IF NOT EXISTS idx_invoices_date ON invoices(date);
CREATE INDEX IF NOT EXISTS idx_invoices_status ON invoices(status);
CREATE INDEX IF NOT EXISTS idx_payments_invoice ON payments(invoice_id);