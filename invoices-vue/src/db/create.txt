//users
db.exec(`CREATE TABLE IF NOT EXISTS users (
    id INTEGER PRIMARY KEY,
    gender TEXT NOT NULL,
    first_name TEXT NOT NULL,
    last_name TEXT NOT NULL,
    password TEXT NOT NULL,
    email TEXT UNIQUE NOT NULL,
    phone TEXT NOT NULL,
    address TEXT NOT NULL,
    postal_code TEXT NOT NULL,
    city TEXT NOT NULL,
    state TEXT NOT NULL,
    country TEXT DEFAULT 'Deutschland',
    website TEXT,
    company_name TEXT NOT NULL,
    company_details TEXT NOT NULL,
    company_signature TEXT NOT NULL,                -- GmbH, AG, OHG vs.
    contact_person TEXT,                       -- Geschäftsführer
    tax_number TEXT NOT NULL,                    -- Steuernummer
    tax_office TEXT,                             -- Opsiyonel (Steueramt)                             -- Opsiyonel (VAT ID prefix, örn: DE)
    vat_id TEXT,                                 -- USt-IdNr
    court_registration TEXT,                     -- Opsiyonel (Handelsregisternummer)
    court_location TEXT,                         -- Amtsgericht Berlin
    logo TEXT NOT NULL,
    image_type TEXT NOT NULL,
    bank_name TEXT NOT NULL,
    bic TEXT NOT NULL,
    iban TEXT NOT NULL,
    bank_account_holder TEXT NOT NULL,
    invoice_approved TEXT NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);`)


//tokens
db.exec(`CREATE TABLE tokens (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    token TEXT UNIQUE NOT NULL,
    user_id INTEGER,
    expires_at DATETIME NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);`)

--------------------------------------------------------------------------------------------------
//customers
db.exec(`CREATE TABLE IF NOT EXISTS customers (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    is_active INTEGER NOT NULL DEFAULT 1,
    company_type TEXT NOT NULL,
    company_name TEXT NOT NULL,
    first_name TEXT NOT NULL,
    last_name TEXT NOT NULL,
    full_name TEXT NOT NULL,
    email TEXT NOT NULL,
    phone TEXT NOT NULL,
    address TEXT NOT NULL,
    postal_code TEXT NOT NULL,
    city TEXT NOT NULL,
    country TEXT NOT NULL,
    tax_number TEXT NOT NULL,
    vat_id TEXT NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
  )`)

---------------------------------------------------------------------------------------------------
//invoices
db.exec(`CREATE TABLE IF NOT EXISTS invoices (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    customer_id INTEGER NOT NULL,
    customer TEXT NOT NULL,
    is_active INTEGER NOT NULL DEFAULT 1,
    cancellation_reason TEXT NOT NULL,
    date TEXT NOT NULL,
    due_date TEXT NOT NULL,
    service_date TEXT NOT NULL,
    currency TEXT NOT NULL,
    payment_terms INTEGER NOT NULL,
    payment_conditions TEXT NOT NULL,
    early_payment_discount INTEGER NOT NULL,
    early_payment_percentage INTEGER NOT NULL,
    early_payment_days INTEGER NOT NULL,
    is_small_company INTEGER NOT NULL,
    is_reverse_charge INTEGER NOT NULL,
    is_eu_delivery INTEGER NOT NULL,
    positions TEXT NOT NULL,
    net_total INTEGER NOT NULL,
    vat_total INTEGER NOT NULL,
    gross_total INTEGER NOT NULL,
    total_after_discount INTEGER NOT NULL,
    has
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (customer_id) REFERENCES customers(id) ON DELETE CASCADE
);`)

-----------------------------------------------------------------------------------------------
//payments
db.exec(`CREATE TABLE IF NOT EXISTS payments (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  invoice_id INTEGER NOT NULL,
  customer_id INTEGER NOT NULL,
  date TEXT NOT NULL,
  paid_amount INTEGER NOT NULL,
  payment_method TEXT NOT NULL,
  payment_reference TEXT NOT NULL,
  counterparty_iban TEXT NOT NULL,
  counterparty_name TEXT NOT NULL,
  notes TEXT NOT NULL,
  is_partially_paid INTEGER NOT NULL,
  is_paid INTEGER NOT NULL,
  file_name TEXT NULL,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (invoice_id) REFERENCES invoices(id) ON DELETE CASCADE,
  FOREIGN KEY (customer_id) REFERENCES customers(id) ON DELETE CASCADE
);`)

--------------------------------------------------------------------------------------------
//reminders
db.exec(
  `CREATE TABLE IF NOT EXISTS reminders (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    is_sent INTEGER NOT NULL DEFAULT 0,          -- 1 = müşteriye gönderildi
    is_cancelled INTEGER NOT NULL DEFAULT 0,     -- storno / iptal edildi mi
    invoice_id INTEGER NOT NULL,
    customer_id INTEGER NOT NULL,
    level INTEGER NOT NULL,                      -- 0 = Zahlungserinnerung, 1 = 1. Mahnung, 2 = 2. Mahnung, 3 = letzte Mahnung
    level_text TEXT NOT NULL,                    -- "Zahlungserinnerung", "1. Mahnung" vs.
    reminder_date TEXT NOT NULL,                 -- PDF’teki resmi Mahnung tarihi (örn. 2025-04-10)
    due_date_new TEXT NOT NULL,                  -- Yeni ödeme son tarihi (örn. +7 gün)
    reminder_fee INTEGER NOT NULL DEFAULT 0,        -- Mahngebühr (örn. 500 = 5,00 €)
    late_interest INTEGER NOT NULL DEFAULT 0,       -- Verzugszinsen toplamı (otomatik hesaplanır)
    intro_text TEXT NOT NULL DEFAULT '',
    main_text TEXT NOT NULL DEFAULT '',
    closing_text TEXT NOT NULL DEFAULT '',
    sent_at TEXT,                                -- Gerçek gönderim tarihi (e-posta/posta)
    sent_method TEXT,                            -- 'email', 'post', 'einschreiben', 'portal'
    proof_type TEXT,                             -- 'email', 'post', 'einschreiben', 'portal'
    proof_file_name TEXT,                        -- Kanıt dosyası (Einschreiben fişi, e-posta ekran görüntüsü vs.)
    proof_sent_at TEXT,                          -- Kanıt tarihi (posta fişi tarihi vs.)
    created_at TEXT DEFAULT (datetime('now')),
    updated_at TEXT DEFAULT (datetime('now')),
    FOREIGN KEY(invoice_id) REFERENCES invoices(id) ON DELETE CASCADE,
    FOREIGN KEY(customer_id) REFERENCES customers(id) ON DELETE CASCADE
);`)


---------------------------------------------------------------------------------------
//offers
db.exec(`CREATE TABLE IF NOT EXISTS offers (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    customer_id INTEGER NOT NULL,
    invoice_id INTEGER,
    customer JSON NOT NULL,
    contact_person TEXT,
    date TEXT NOT NULL,
    valid_until TEXT NOT NULL,
    subject TEXT NOT NULL,
    currency TEXT NOT NULL,
    payment_terms TEXT NOT NULL,
    delivery_terms TEXT NOT NULL,
    delivery_time TEXT NOT NULL,
    net_total INTEGER INTEGER NOT NULL,
    vat_total INTEGER INTEGER NOT NULL,
    gross_total INTEGER NOT NULL,
    status TEXT NOT NULL,
    is_active INTEGER NOT NULL DEFAULT 1,
    is_legal INTEGER NOT NULL DEFAULT 1,
    accepted_at TEXT,
    rejected_at TEXT,
    introduction_text TEXT NOT NULL,
    closing_text TEXT NOT NULL,
    notes TEXT NOT NULL,
    internal_notes TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (customer_id) REFERENCES customers(id) ON DELETE RESTRICT,
    FOREIGN KEY (invoice_id) REFERENCES invoices(id) ON DELETE SET NULL
);`)


'draft'
        CHECK (status IN ('draft','sent','accepted','rejected','expired','converted')),
--------------------------------------------------------------------------------------
//orders
db.exec(`CREATE TABLE IF NOT EXISTS orders (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    customer_id INTEGER NOT NULL,
    customer TEXT NOT NULL,
    date TEXT NOT NULL,                  
    validity_date TEXT,                   
    service_period_start TEXT,
    service_period_end TEXT,
    delivery_date TEXT,
    is_active INTEGER NOT NULL DEFAULT 1,
    is_cancelled INTEGER NOT NULL DEFAULT 0,
    delivery_address TEXT,
    delivery_postal_code TEXT,
    delivery_city TEXT,
    delivery_country TEXT DEFAULT 'Deutschland',
    payment_terms TEXT,
    payment_method TEXT,
    payment_conditions TEXT,
    delivery_terms TEXT,
    shipping_method TEXT,
    net_total INTEGER NOT NULL DEFAULT 0,
    vat_total INTEGER NOT NULL DEFAULT 0,
    gross_total INTEGER NOT NULL DEFAULT 0,
    intro_text TEXT DEFAULT '',
    customer_notes TEXT DEFAULT '',
    internal_notes TEXT DEFAULT '',
    closing_text TEXT DEFAULT '',
    positions TEXT NOT NULL,
    sent_at TEXT,
    sent_method TEXT,
    created_at TEXT DEFAULT (datetime('now')),
    updated_at TEXT DEFAULT (datetime('now')),
    FOREIGN KEY (customer_id) REFERENCES customers(id) ON DELETE RESTRICT
);`)

-------------------------------------------------------------------------------------
//deliveries
db.exec(`CREATE TABLE IF NOT EXISTS deliveries (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    delivery_number TEXT UNIQUE,                    -- LFS2025-00001 (GoBD’de art arda numara zorunlu!)
    order_id INTEGER,                               -- Auftrag’a bağlı (opsiyonel)
    invoice_id INTEGER,                             -- Daha sonra faturaya bağlanabilir
    customer_id INTEGER NOT NULL,
    delivery_date TEXT NOT NULL,                    -- Gerçek teslim tarihi (PDF’teki resmi tarih)
    planned_delivery_date TEXT,                     -- Planlanan tarih (opsiyonel)
    status TEXT NOT NULL DEFAULT 'pending',         -- pending, in_transit, delivered, partial, cancelled
    is_active INTEGER NOT NULL DEFAULT 1,
    is_cancelled INTEGER NOT NULL DEFAULT 0,
    delivered_by TEXT,                              -- DHL, UPS, kendi araç, Abholung vs.
    delivery_method TEXT,                           -- Paket, Spedition, digital, Abholung
    tracking_number TEXT,                           -- DHL Sendungsnummer vs.
    delivery_reference TEXT,                        -- Lieferschein-Nummer, Kunde Referenz
    received_by TEXT,                               -- İmza atan kişi (fişte yazmalı)
    received_at TEXT,                               -- İmza zamanı (eğer dijitalse)
    delivery_address TEXT,
    delivery_postal_code TEXT,
    delivery_city TEXT,
    delivery_country TEXT DEFAULT 'Deutschland',
    positions TEXT NOT NULL,                        -- [{"id":1, "qty":5, "delivered_qty":5}, ...]
    delivered_total_cent INTEGER NOT NULL DEFAULT 0,
    remaining_total_cent INTEGER NOT NULL DEFAULT 0,
    note TEXT DEFAULT '',
    internal_note TEXT DEFAULT '',
    pdf_file_name TEXT,                             -- Lieferschein PDF’i
    proof_file_name TEXT,                           -- İmza fotoğrafı, DHL Beleg vs.
    proof_type TEXT,                                -- 'signature', 'photo', 'tracking', 'digital'
    created_at TEXT DEFAULT (datetime('now')),
    updated_at TEXT DEFAULT (datetime('now')),
    FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE SET NULL,
    FOREIGN KEY (invoice_id) REFERENCES invoices(id) ON DELETE SET NULL,
    FOREIGN KEY (customer_id) REFERENCES customers(id) ON DELETE CASCADE
);`)