//users
db.exec(`CREATE TABLE IF NOT EXISTS users (
    id INTEGER PRIMARY KEY,
    gender TEXT NOT NULL,
    first_name TEXT NOT NULL,
    last_name TEXT NOT NULL,
    password TEXT NOT NULL,
    email TEXT UNIQUE NOT NULL,
    phone TEXT NOT NULL,
    address TEXT NOT NULL,
    postal_code TEXT NOT NULL,
    city TEXT NOT NULL,
    state TEXT NOT NULL,
    country TEXT DEFAULT 'Deutschland',
    website TEXT,
    company_name TEXT NOT NULL,
    company_details TEXT NOT NULL,
    company_signature TEXT NOT NULL,                -- GmbH, AG, OHG vs.
    contact_person TEXT,                       -- Geschäftsführer
    tax_number TEXT NOT NULL,                    -- Steuernummer
    tax_office TEXT,                             -- Opsiyonel (Steueramt)                             -- Opsiyonel (VAT ID prefix, örn: DE)
    vat_id TEXT,                                 -- USt-IdNr
    court_registration TEXT,                     -- Opsiyonel (Handelsregisternummer)
    court_location TEXT,                         -- Amtsgericht Berlin
    logo TEXT NOT NULL,
    image_type TEXT NOT NULL,
    bank_name TEXT NOT NULL,
    bic TEXT NOT NULL,
    iban TEXT NOT NULL,
    bank_account_holder TEXT NOT NULL,
    invoice_approved TEXT NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);`)


//tokens
db.exec(`CREATE TABLE tokens (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    token TEXT UNIQUE NOT NULL,
    user_id INTEGER,
    expires_at DATETIME NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);`)

--------------------------------------------------------------------------------------------------
//customers
db.exec(`CREATE TABLE IF NOT EXISTS customers (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    is_active INTEGER NOT NULL DEFAULT 1,
    company_type TEXT NOT NULL,
    company_name TEXT NOT NULL,
    first_name TEXT NOT NULL,
    last_name TEXT NOT NULL,
    full_name TEXT NOT NULL,
    email TEXT NOT NULL,
    phone TEXT NOT NULL,
    address TEXT NOT NULL,
    postal_code TEXT NOT NULL,
    city TEXT NOT NULL,
    country TEXT NOT NULL,
    tax_number TEXT NOT NULL,
    vat_id TEXT NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
  )`)

db.exec(`
 CREATE INDEX IF NOT EXISTS idx_customers_is_active ON customers(is_active);
 CREATE INDEX IF NOT EXISTS idx_customers_email ON customers(email);
 CREATE INDEX IF NOT EXISTS idx_customers_tax_number ON customers(tax_number);
`)

---------------------------------------------------------------------------------------------------
//invoices
db.exec(`CREATE TABLE IF NOT EXISTS invoices (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    customer_id INTEGER NOT NULL,
    is_active INTEGER NOT NULL DEFAULT 1,
    date TEXT NOT NULL,
    due_date TEXT NOT NULL,
    service_date TEXT NOT NULL,
    currency TEXT NOT NULL,
    payment_terms INTEGER NOT NULL,
    payment_conditions TEXT NOT NULL,
    early_payment_discount INTEGER NOT NULL,
    early_payment_percentage INTEGER NOT NULL,
    early_payment_days INTEGER NOT NULL,
    is_small_company INTEGER NOT NULL,
    is_reverse_charge INTEGER NOT NULL,
    is_eu_delivery INTEGER NOT NULL,
    positions TEXT NOT NULL,
    subtotal INTEGER NOT NULL,
    vat_amount INTEGER NOT NULL,
    total INTEGER NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);`)

db.exec(`
 CREATE INDEX IF NOT EXISTS idx_invoices_is_active ON invoices(is_active);
 CREATE INDEX IF NOT EXISTS idx_invoices_date ON invoices(date);
 CREATE INDEX IF NOT EXISTS idx_invoices_total ON invoices(total);
`)

-----------------------------------------------------------------------------------------------
//payments
db.exec(`CREATE TABLE IF NOT EXISTS payments (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  invoice_id INTEGER NOT NULL,
  customer_id INTEGER NOT NULL,
  date TEXT NOT NULL,
  amount INTEGER NOT NULL,
  method TEXT NOT NULL,
  reference TEXT NOT NULL,
  notes TEXT NOT NULL,
  is_partially_paid INTEGER NOT NULL,
  is_paid INTEGER NOT NULL,
  file_name TEXT NULL,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (invoice_id) REFERENCES invoices(id) ON DELETE CASCADE,
  FOREIGN KEY (customer_id) REFERENCES customers(id) ON DELETE CASCADE
);`)

db.exec(`
 CREATE INDEX IF NOT EXISTS idx_payments_id ON payments(id);
 CREATE INDEX IF NOT EXISTS idx_payments_invoice_id ON payments(invoice_id);
 CREATE INDEX IF NOT EXISTS idx_payments_customer_id ON payments(customer_id);
`)

--------------------------------------------------------------------------------------------
//reminders
db.exec(`CREATE TABLE IF NOT EXISTS reminders (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    is_active INTEGER NOT NULL DEFAULT 1,
    invoice_id INTEGER NOT NULL,
    customer_id INTEGER NOT NULL,
    date TEXT NOT NULL,
    reminder_fee REAL NOT NULL,
    late_fee REAL NOT NULL,
    level TEXT NOT NULL,
    intro_text TEXT NOT NULL,
    warning_text TEXT NOT NULL,
    closing_text TEXT NOT NULL,
    payment_deadline TEXT NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY(invoice_id) REFERENCES invoices(id),
    FOREIGN KEY(customer_id) REFERENCES customers(id)
);
`)

db.exec(`
CREATE INDEX IF NOT EXISTS idx_reminders_date ON reminders(date);
CREATE INDEX IF NOT EXISTS idx_reminders_customer_id ON reminders(customer_id);
CREATE INDEX IF NOT EXISTS idx_reminders_invoice_id ON reminders(invoice_id);
`)

---------------------------------------------------------------------------------------
//offers
db.exec(`CREATE TABLE IF NOT EXISTS offers (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    customer_id INTEGER NOT NULL,
    date TEXT NOT NULL,
    valid_until TEXT,
    subject TEXT,
    is_active INTEGER NOT NULL DEFAULT 1,
    is_legal INTEGER NOT NULL DEFAULT 0,
    company_name TEXT,
    first_name TEXT,
    last_name TEXT,
    address TEXT,
    postal_code TEXT,
    city TEXT,
    currency TEXT NOT NULL,
    paid_amount REAL DEFAULT 0,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (customer_id) REFERENCES customers(id) ON DELETE CASCADE
  );`)


db.exec(`
 CREATE INDEX IF NOT EXISTS idx_offers_id ON offers(id);
 CREATE INDEX IF NOT EXISTS idx_offers_date ON offers(date);
 CREATE INDEX IF NOT EXISTS idx_offers_customer_id ON offers(customer_id);
`)

--------------------------------------------------------------------------------------
//orders
db.exec(`CREATE TABLE IF NOT EXISTS orders (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    customer_id INTEGER NOT NULL,
    date TEXT NOT NULL,
    is_legal INTEGER NOT NULL DEFAULT 0,
    is_active INTEGER NOT NULL DEFAULT 1,
    service_period_start TEXT,
    service_period_end TEXT,
    validity_date TEXT,
    delivery_date TEXT,
    delivery_address TEXT,
    company_name TEXT,
    first_name TEXT,
    last_name TEXT,
    address TEXT,
    postal_code TEXT,
    city TEXT,
    country TEXT,
    email TEXT,
    customer_reference TEXT,
    payment_terms TEXT,
    payment_method TEXT,
    payment_conditions TEXT,
    payment_purpose TEXT,
    paid_amount REAL DEFAULT 0,
    delivery_terms TEXT,
    shipping_method TEXT,
    customer_notes TEXT,
    internal_notes TEXT,
    special_notes TEXT,
    closing_text TEXT,
    positions TEXT NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (customer_id) REFERENCES customers(id) ON DELETE CASCADE
);
`)

db.exec(`
 CREATE INDEX IF NOT EXISTS idx_orders_id ON orders(id);
 CREATE INDEX IF NOT EXISTS idx_orders_date ON orders(date);
 CREATE INDEX IF NOT EXISTS idx_orders_customer_id ON orders(customer_id);
`)

-------------------------------------------------------------------------------------
//deliveries
db.exec(`
  CREATE TABLE IF NOT EXISTS deliveries (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    order_id INTEGER,
    customer_id INTEGER NOT NULL,
    is_active INTEGER NOT NULL DEFAULT 1,
    date TEXT,
    delivery_status TEXT DEFAULT 'pending',
    delivered_by TEXT,
    delivery_reference TEXT,
    received_by TEXT,
    note TEXT,
    positions TEXT NOT NULL,  -- JSON string
    created_at TEXT DEFAULT CURRENT_TIMESTAMP,
    updated_at TEXT DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE,
    FOREIGN KEY (customer_id) REFERENCES customers(id) ON DELETE CASCADE
  );
`)
db.exec(`
 CREATE INDEX IF NOT EXISTS idx_deliveries_id ON deliveries(id);
 CREATE INDEX IF NOT EXISTS idx_deliveries_date ON deliveries(date);
 CREATE INDEX IF NOT EXISTS idx_deliveries_customer_id ON deliveries(customer_id);
`)



