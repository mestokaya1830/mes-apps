
CREATE TABLE IF NOT EXISTS customers (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  is_active INTEGER NOT NULL DEFAULT 1,

  date TEXT NOT NULL,
  
  company_type TEXT DEFAULT NULL,
  company_name TEXT DEFAULT NULL,

  first_name TEXT DEFAULT NULL,
  last_name TEXT DEFAULT NULL,
  full_name TEXT GENERATED ALWAYS AS (COALESCE(first_name,'') || ' ' || COALESCE(last_name,'')) VIRTUAL,

  email TEXT DEFAULT NULL,
  phone TEXT DEFAULT NULL,
  website TEXT DEFAULT NULL,
  address TEXT DEFAULT NULL,
  postal_code TEXT DEFAULT NULL,
  city TEXT DEFAULT NULL,
  country TEXT DEFAULT 'Deutschland',

  tax_number TEXT DEFAULT NULL,
  vat_id TEXT DEFAULT NULL,

  created_at DATETIME DEFAULT (datetime('now')),
  updated_at DATETIME DEFAULT (datetime('now'))
);


-- indexes --

CREATE INDEX IF NOT EXISTS idx_customers_is_active ON customers(is_active);
CREATE INDEX IF NOT EXISTS idx_customers_email ON customers(email);

-- trigger --

CREATE TRIGGER IF NOT EXISTS trg_customers_updated_at
AFTER UPDATE ON customers
BEGIN
  UPDATE customers SET updated_at = datetime('now') WHERE id = NEW.id;
END;